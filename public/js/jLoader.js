function Loader(c,d){if(!c){c="body"}this.div_id=c;this.overlayColor="#000000";this.userCallback=0;this.showProgress=false;this.showProgressText=false;this.progressColor="#ffffff";this.textColor="#ffffff";this.textSize="15";this.loaderPosition={top:"50",left:"50"};if(d){this.overlayColor=(!d.overlayColor)?this.overlayColor:d.overlayColor;this.userCallback=(!d.userCallback)?this.userCallback:d.userCallback;this.showProgress=(!d.showProgress)?this.showProgress:d.showProgress;this.showProgressText=(!d.showProgressText)?this.showProgressText:d.showProgressText;this.progressColor=(!d.progressColor)?this.progressColor:d.progressColor;this.textColor=(!d.textColor)?this.textColor:d.textColor;this.textSize=(!d.textSize)?this.textSize:d.textSize;if(d.loaderPosition){this.loaderPosition.top=(!d.loaderPosition.top)?this.loaderPosition.top:d.loaderPosition.top;this.loaderPosition.left=(!d.loaderPosition.left)?this.loaderPosition.left:d.loaderPosition.left}this.debug=(!d.debug)?false:d.debug}this.Stop=function(){if(!this.started){return}clearTimeout(this.ieTimeout);if(!this.toLoadImages){return}for(var a=0;a<this.toLoadImages.length;++a){this.toLoadImages[a].unbind("load")}this.toLoadImages=0;this.started=false};this.Start=function(){if(this.started){return}if(navigator.userAgent.match(/MSIE (\d+(?:\.\d+)+(?:b\d*)?)/)=="MSIE 6.0,6.0"){if(this.userCallback){this.userCallback()}return}this.images=this.getImages();if(this.images.length==0){if(this.userCallback){this.userCallback()}return}this.started=true;this.width=$(this.div_id).outerWidth();this.height=$(this.div_id).outerHeight();this.position=$(this.div_id).offset();this.overlay=$("<div></div>").appendTo($(this.div_id));var b={"background-color":this.overlayColor,"z-index":"9999",position:"fixed",top:this.position.top,left:this.position.left,width:this.width+"px",height:this.height+"px"};$(this.overlay).css(b);this.preloader=$("<div></div>").appendTo(this.selectorPreload);$(this.preloader).css({height:"0px",width:"0px",overflow:"hidden"});this.imagesLoaded=0;var j=this;var a=this.imgLoaded;if(this.showProgress){this.loadBar=$("<div></div>").appendTo($(this.overlay));$(this.loadBar).css({"background-color":this.progressColor,height:"1px",position:"relative",top:this.loaderPosition.top+"%",width:"0%"})}if(this.showProgressText){this.loadAmt=$("<div>0%</div>").appendTo($(this.overlay));$(this.loadAmt).css({color:this.textColor,"font-family":'"Trebuchet MS",Arial,Helvetica,sans-serif',"font-size":this.textSize+"px","font-weight":"bold","line-height":"50px",height:"50px",width:"100px",margin:"-60px 0 0 -50px",position:"relative",top:this.loaderPosition.top+"%",left:this.loaderPosition.left+"%"})}var k=this;$(window).resize(function(){if(!k.overlay){return}k.width=$(k.div_id).outerWidth();k.height=$(k.div_id).outerHeight();k.position=$(k.div_id).offset();var e={top:k.position.top,left:k.position.left,width:k.width+"px",height:k.height+"px"};$(k.overlay).css(e)});this.toLoadImages=new Array();for(var l=0;l<this.images.length;l++){var i=$("<img></img>");$(i).attr("src",this.images[l]);$(i).unbind("load");$(i).bind("load",function(){a(j)});$(i).appendTo($(this.preloader));this.toLoadImages.push($(i))}var k=this;if($.browser.msie){this.ieTimeout=setTimeout(k.ieLoadFix(k),2000)}};this.ieLoadFix=function(a){while((100/a.images.length)*a.imagesLoaded<100){a.imgLoaded(a)}};this.animateLoader=function(a){var b=(100/a.images.length)*a.imagesLoaded;if(b>99){if(a.loadAmt){$(a.loadAmt).html("100%")}if(a.loadBar){$(a.loadBar).stop().animate({width:b+"%"},500,"linear",function(){a.doneLoading(a)})}else{a.doneLoading()}}else{if(a.loadBar){$(a.loadBar).stop().animate({width:b+"%"},500,"linear",function(){})}if(a.loadAmt){$(a.loadAmt).html(Math.floor(b)+"%")}}};this.imgLoaded=function(a){a.imagesLoaded++;a.animateLoader(a)};this.doneLoading=function(a){$(a.preloader).remove();var b=a.userCallback;if(this.started){a.overlay.fadeOut("slow",function(){$(this).remove();if(b){b()}})}else{$(a.overlay).remove()}a.overlay.fadeOut("slow",function(){$(this).remove();if(b){b()}});a.overlay=0;this.started=false;this.toLoadImages=0};this.getImages=function(){var a=new Array();var h="";if($(this.div_id).css("background-image")!="none"){h=$(this.div_id).css("background-image")}else{if(typeof($(this.div_id).attr("src"))!="undefined"&&$(this.div_id).attr("tagName").toLowerCase()=="img"){h=$(this.div_id).attr("src")}}h=h.replace('url("',"");h=h.replace("url(","");h=h.replace('")',"");h=h.replace(")","");if(h.length>0){a.push(h)}var b=this;var g=$(this.div_id).find("*:not(script)").each(function(){var e="";if($(this).css("background-image")!="none"){e=$(this).css("background-image")}else{if(typeof($(this).attr("src"))!="undefined"&&$(this).attr("tagName").toLowerCase()=="img"){e=$(this).attr("src")}}e=e.replace('url("',"");e=e.replace("url(","");e=e.replace('")',"");e=e.replace(")","");if(e.length>0){a.push(e)}});return a}};