(function(c,d){if(typeof define==="function"&&define.amd){define("angular-file-upload",["angular"],function(a){return d(a)})}else{return d(c)}}(angular||null,function(d){var c=d.module("angularFileUpload",[]);c.directive("ngFileDrop",["$fileUploader",function(a){return{link:!a.isHTML5?d.noop:function(b,g,h){g.bind("drop",function(f){var e=f.dataTransfer?f.dataTransfer:f.originalEvent.dataTransfer;if(!e){return}f.preventDefault();f.stopPropagation();b.$broadcast("file:removeoverclass");b.$emit("file:add",e.files,b.$eval(h.ngFileDrop))}).bind("dragover",function(f){var e=f.dataTransfer?f.dataTransfer:f.originalEvent.dataTransfer;f.preventDefault();f.stopPropagation();e.dropEffect="copy";b.$broadcast("file:addoverclass")}).bind("dragleave",function(){b.$broadcast("file:removeoverclass")})}}}]);c.directive("ngFileOver",function(){return{link:function(a,b,f){a.$on("file:addoverclass",function(){b.addClass(f.ngFileOver||"ng-file-over")});a.$on("file:removeoverclass",function(){b.removeClass(f.ngFileOver||"ng-file-over")})}}});c.directive("ngFileSelect",["$fileUploader",function(a){return{link:function(b,g,h){a.isHTML5||g.removeAttr("multiple");g.bind("change",function(){b.$emit("file:add",a.isHTML5?this.files:this,b.$eval(h.ngFileSelect));(a.isHTML5&&g.attr("multiple"))&&g.prop("value",null)});g.prop("value",null)}}}]);c.factory("$fileUploader",["$compile","$rootScope","$http","$window",function(j,l,a,b){function i(e){d.extend(this,{scope:l,url:"/",alias:"file",queue:[],headers:{},progress:null,autoUpload:false,removeAfterUpload:false,method:"POST",filters:[],formData:[],isUploading:false,queueLimit:Number.MAX_VALUE,_nextIndex:0,_timestamp:Date.now()},e);this.filters.unshift(this._emptyFileFilter);this.filters.unshift(this._queueLimitFilter);this.scope.$on("file:add",function(f,h,g){f.stopPropagation();this.addToQueue(h,g)}.bind(this));this.bind("beforeupload",k.prototype._beforeupload);this.bind("in:progress",k.prototype._progress);this.bind("in:success",k.prototype._success);this.bind("in:cancel",k.prototype._cancel);this.bind("in:error",k.prototype._error);this.bind("in:complete",k.prototype._complete);this.bind("in:progress",this._progress);this.bind("in:complete",this._complete)}i.prototype={constructor:i,_emptyFileFilter:function(e){return d.isElement(e)?true:!!e.size},_queueLimitFilter:function(){return this.queue.length<this.queueLimit},bind:function(e,f){return this.scope.$on(this._timestamp+":"+e,f.bind(this))},trigger:function(f,e){arguments[0]=this._timestamp+":"+f;this.scope.$broadcast.apply(this.scope,arguments)},isHTML5:!!(b.File&&b.FormData),addToQueue:function(h,g){var f=this.queue.length;var e="length" in h?h:[h];d.forEach(e,function(p){var q=!this.filters.length?true:this.filters.every(function(m){return m.call(this,p)},this);var r=new k(d.extend({url:this.url,alias:this.alias,headers:d.copy(this.headers),formData:d.copy(this.formData),removeAfterUpload:this.removeAfterUpload,method:this.method,uploader:this,file:p},g));if(q){this.queue.push(r);this.trigger("afteraddingfile",r)}else{this.trigger("whenaddingfilefailed",r)}},this);if(this.queue.length!==f){this.trigger("afteraddingall",this.queue);this.progress=this._getTotalProgress()}this._render();this.autoUpload&&this.uploadAll()},removeFromQueue:function(e){var g=this.getIndexOfItem(e);var f=this.queue[g];f.isUploading&&f.cancel();this.queue.splice(g,1);f._destroy();this.progress=this._getTotalProgress()},clearQueue:function(){this.queue.forEach(function(e){e.isUploading&&e.cancel();e._destroy()},this);this.queue.length=0;this.progress=0},getIndexOfItem:function(e){return d.isObject(e)?this.queue.indexOf(e):e},getNotUploadedItems:function(){return this.queue.filter(function(e){return !e.isUploaded})},getReadyItems:function(){return this.queue.filter(function(e){return e.isReady&&!e.isUploading}).sort(function(e,f){return e.index-f.index})},uploadItem:function(f){var h=this.getIndexOfItem(f);var g=this.queue[h];var e=this.isHTML5?"_xhrTransport":"_iframeTransport";g.index=g.index||this._nextIndex++;g.isReady=true;if(this.isUploading){return}this.isUploading=true;this[e](g)},cancelItem:function(f){var h=this.getIndexOfItem(f);var g=this.queue[h];var e=this.isHTML5?"_xhr":"_form";g[e]&&g[e].abort()},uploadAll:function(){var e=this.getNotUploadedItems().filter(function(f){return !f.isUploading});e.forEach(function(f){f.index=f.index||this._nextIndex++;f.isReady=true},this);e.length&&this.uploadItem(e[0])},cancelAll:function(){this.getNotUploadedItems().forEach(function(e){this.cancelItem(e)},this)},_render:function(){this.scope.$$phase||this.scope.$digest()},_getTotalProgress:function(f){if(this.removeAfterUpload){return f||0}var h=this.getNotUploadedItems().length;var n=h?this.queue.length-h:this.queue.length;var g=100/this.queue.length;var e=(f||0)*g/100;return Math.round(n*g+e)},_progress:function(e,f,g){var h=this._getTotalProgress(g);this.trigger("progressall",h);this.progress=h;this._render()},_complete:function(){var e=this.getReadyItems()[0];this.isUploading=false;if(d.isDefined(e)){this.uploadItem(e);return}this.trigger("completeall",this.queue);this.progress=this._getTotalProgress();this._render()},_xhrTransport:function(f){var e=f._xhr=new XMLHttpRequest();var g=new FormData();var h=this;this.trigger("beforeupload",f);f.formData.forEach(function(n){d.forEach(n,function(m,p){g.append(p,m)})});g.append(f.alias,f.file);e.upload.onprogress=function(p){var o=p.lengthComputable?p.loaded*100/p.total:0;h.trigger("in:progress",f,Math.round(o))};e.onload=function(){var o=h._transformResponse(e.response);var p=h._isSuccessCode(e.status)?"success":"error";h.trigger("in:"+p,e,f,o);h.trigger("in:complete",e,f,o)};e.onerror=function(){h.trigger("in:error",e,f);h.trigger("in:complete",e,f)};e.onabort=function(){h.trigger("in:cancel",e,f);h.trigger("in:complete",e,f)};e.open(f.method,f.url,true);d.forEach(f.headers,function(p,o){e.setRequestHeader(o,p)});e.send(g)},_iframeTransport:function(e){var f=d.element('<form style="display: none;" />');var h=d.element('<iframe name="iframeTransport'+Date.now()+'">');var n=e._input;var g=this;e._form&&e._form.replaceWith(n);e._form=f;this.trigger("beforeupload",e);n.prop("name",e.alias);e.formData.forEach(function(m){d.forEach(m,function(q,r){f.append(d.element('<input type="hidden" name="'+r+'" value="'+q+'" />'))})});f.prop({action:e.url,method:e.method,target:h.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"});h.bind("load",function(){var q=h[0].contentDocument.body.innerHTML;var m={response:q,status:200,dummy:true};var r=g._transformResponse(m.response);g.trigger("in:success",m,e,r);g.trigger("in:complete",m,e,r)});f.abort=function(){var m={status:0,dummy:true};h.unbind("load").prop("src","javascript:false;");f.replaceWith(n);g.trigger("in:cancel",m,e);g.trigger("in:complete",m,e)};n.after(f);f.append(n).append(h);f[0].submit()},_isSuccessCode:function(e){return(e>=200&&e<300)||e===304},_transformResponse:function(e){a.defaults.transformResponse.forEach(function(f){e=f(e)});return e}};function k(f){if(!i.prototype.isHTML5){var h=d.element(f.file);var e=j(h.clone())(f.uploader.scope);var g=h.val();f.file={lastModifiedDate:null,size:null,type:"like/"+g.slice(g.lastIndexOf(".")+1).toLowerCase(),name:g.slice(g.lastIndexOf("/")+g.lastIndexOf("\\")+2)};f._input=h;e.prop("value",null);h.css("display","none").after(e)}d.extend(this,{isReady:false,isUploading:false,isUploaded:false,isSuccess:false,isCancel:false,isError:false,progress:null,index:null},f)}k.prototype={constructor:k,remove:function(){this.uploader.removeFromQueue(this)},upload:function(){this.uploader.uploadItem(this)},cancel:function(){this.uploader.cancelItem(this)},_destroy:function(){this._form&&this._form.remove();this._input&&this._input.remove();delete this._form;delete this._input},_beforeupload:function(e,f){f.isReady=true;f.isUploading=true;f.isUploaded=false;f.isSuccess=false;f.isCancel=false;f.isError=false;f.progress=0},_progress:function(e,f,g){f.progress=g;f.uploader.trigger("progress",f,g)},_success:function(f,e,g,h){g.isReady=false;g.isUploading=false;g.isUploaded=true;g.isSuccess=true;g.isCancel=false;g.isError=false;g.progress=100;g.index=null;g.uploader.trigger("success",e,g,h)},_cancel:function(f,e,g){g.isReady=false;g.isUploading=false;g.isUploaded=false;g.isSuccess=false;g.isCancel=true;g.isError=false;g.progress=0;g.index=null;g.uploader.trigger("cancel",e,g)},_error:function(f,e,g,h){g.isReady=false;g.isUploading=false;g.isUploaded=true;g.isSuccess=false;g.isCancel=false;g.isError=true;g.progress=100;g.index=null;g.uploader.trigger("error",e,g,h)},_complete:function(f,e,g,h){g.uploader.trigger("complete",e,g,h);g.removeAfterUpload&&g.remove()}};return{create:function(e){return new i(e)},isHTML5:i.prototype.isHTML5}}]);return c}));